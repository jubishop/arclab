<%- include('../partials/header') %>

<div class="container">
  <div class="item-header">
    <h1><%= item.name %></h1>
    <div class="actions">
      <a href="/items/<%= item.id %>/edit" class="btn">Edit</a>
      <form action="/items/<%= item.id %>/delete" method="POST" style="display:inline" onsubmit="return confirm('Delete this item?')">
        <button type="submit" class="btn btn-danger">Delete</button>
      </form>
    </div>
  </div>

  <div class="item-details">
    <% if (item.image_path) { %>
      <div class="item-image">
        <img src="<%= item.image_path %>" alt="<%= item.name %>">
      </div>
    <% } %>
    <div class="item-info">
      <p><strong>Category:</strong> <span class="category-badge <%= item.category.replace(/ /g, '-') %>"><%= item.category %></span></p>
      <% if (item.rarity) { %>
        <p><strong>Rarity:</strong> <span class="rarity-badge rarity-<%= item.rarity.toLowerCase() %>"><%= item.rarity %></span></p>
      <% } %>
      <p><strong>Stack Size:</strong> <%= item.stack_size %></p>
    </div>
  </div>

  <% if (usedIn && usedIn.length > 0) { %>
    <div class="used-in-section">
      <h2>Used In</h2>
      <table>
        <thead>
          <tr>
            <th>Item</th>
            <th>Category</th>
            <th>Quantity Needed</th>
          </tr>
        </thead>
        <tbody>
          <% usedIn.forEach(u => { %>
            <tr>
              <td><a href="/items/<%= u.id %>"><%= u.name %></a></td>
              <td><span class="category-badge <%= u.category.replace(/ /g, '-') %>"><%= u.category %></span></td>
              <td><%= u.quantity %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  <% } %>

  <% if (recipe.length > 0) { %>
    <div class="recipe-section">
      <h2>Crafting Recipe</h2>
      <table>
        <thead>
          <tr>
            <th>Material</th>
            <th>Quantity</th>
            <th>Stack Size</th>
          </tr>
        </thead>
        <tbody>
          <% recipe.forEach(r => { %>
            <tr>
              <td><a href="/items/<%= r.material_id %>"><%= r.material_name %></a></td>
              <td><%= r.quantity %></td>
              <td><%= r.material_stack_size %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <% if (inventoryAnalysis) { %>
      <div class="inventory-analysis">
        <h2>Inventory Efficiency</h2>
        <div class="analysis-result <%= inventoryAnalysis.recommendation %>">
          <p class="recommendation"><%= inventoryAnalysis.message %></p>
          <div class="analysis-details">
            <p><strong>Slots per crafted item:</strong> <%= inventoryAnalysis.slotsPerItem %></p>
            <p><strong>Slots for materials (per craft):</strong> <%= inventoryAnalysis.slotsForMaterials %></p>
          </div>
        </div>
      </div>
    <% } %>
  <% } else { %>
    <p class="base-item">This is a base item (not craftable).</p>
  <% } %>

  <p><a href="/items">&larr; Back to all items</a></p>
</div>

<%- include('../partials/footer') %>
